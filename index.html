<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุญุงูุงุฉ ุงูุทุงูุฉ ุงูุดูุณูุฉ - ูุฎููุงุช ุบุฒุฉ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap');
        
        * {
            font-family: 'Tajawal', sans-serif;
        }
        
        .glow {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.6);
            animation: glow 2s infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 10px rgba(59, 130, 246, 0.4); }
            to { box-shadow: 0 0 25px rgba(59, 130, 246, 0.8); }
        }
        
        .pulse-warning {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }
        
        .sun-animation {
            transition: all 0.5s ease;
        }
        
        .load-active {
            transform: scale(1.02);
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <div class="bg-white p-6 rounded-2xl shadow-lg mb-6 border-r-4 border-blue-500">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="text-center md:text-right">
                    <h1 class="text-3xl font-bold text-gray-800">ูุธุงู ูุญุงูุงุฉ ุงูุทุงูุฉ ุงูุดูุณูุฉ (5kW)</h1>
                    <p class="text-gray-600 mt-2">ูุดุฑูุน ุงูุทุงูุฉ ุงูุดูุณูุฉ ููุฎููุงุช ุงููุงุฒุญูู - ูุทุงุน ุบุฒุฉ</p>
                    <div class="mt-3 flex flex-wrap gap-2 justify-center">
                        <span class="bg-blue-100 text-blue-800 text-sm px-3 py-1 rounded-full">100 ูุญุฏุฉ ุดูุณูุฉ</span>
                        <span class="bg-green-100 text-green-800 text-sm px-3 py-1 rounded-full">50,000 ูุณุชููุฏ</span>
                        <span class="bg-purple-100 text-purple-800 text-sm px-3 py-1 rounded-full">ุทุงูุฉ ูุธููุฉ</span>
                    </div>
                </div>
                <div class="text-center">
                    <div class="text-4xl font-bold text-blue-600 bg-blue-50 px-6 py-3 rounded-xl">
                        <span id="currentTime">06:00 ุต</span>
                    </div>
                    <button id="simulationToggle" class="mt-3 px-6 py-2 text-base rounded-full font-bold bg-green-500 text-white hover:bg-green-600 transition-all duration-300 transform hover:scale-105">
                        ุชุดุบูู ุงููุญุงูุงุฉ โถ
                    </button>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- ุงูุฌุงูุจ ุงูุฃูุณุฑ: ุงูุชูููุฏ ูุงูุชุฎุฒูู -->
            <div class="space-y-6">
                <!-- ุงูุฃููุงุญ ุงูุดูุณูุฉ -->
                <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-200">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-xl text-gray-700 flex items-center gap-3">
                            <i class="fas fa-sun text-yellow-500 text-2xl"></i>
                            ุงูุฃููุงุญ ุงูุดูุณูุฉ
                        </h3>
                        <span class="text-sm font-bold bg-gray-100 px-3 py-1 rounded">5.5 kWp</span>
                    </div>
                    <div class="flex items-end gap-3 mb-3">
                        <span id="pvOutput" class="text-5xl font-bold text-gray-800">0.00</span>
                        <span class="text-gray-600 mb-2">ูููู ูุงุท</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3 mb-2">
                        <div id="pvProgress" class="bg-yellow-500 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                    <div class="flex justify-between text-sm text-gray-500">
                        <span>0%</span>
                        <span id="pvEfficiency">ููุงุกุฉ: 0%</span>
                        <span>100%</span>
                    </div>
                </div>

                <!-- ุงูุจุทุงุฑูุฉ -->
                <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-200">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-xl text-gray-700 flex items-center gap-3">
                            <i class="fas fa-battery-full text-green-600 text-2xl"></i>
                            ุจุทุงุฑูุฉ ุงูููุซููู
                        </h3>
                        <span class="text-sm font-bold bg-gray-100 px-3 py-1 rounded">18 kWh</span>
                    </div>
                    <div class="flex items-end gap-3 mb-3">
                        <span id="batterySoc" class="text-5xl font-bold text-gray-800">50%</span>
                        <span class="text-gray-600 mb-2">ูุณุจุฉ ุงูุดุญู</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                        <div id="batteryProgress" class="h-4 rounded-full transition-all duration-500 bg-green-500" style="width: 50%"></div>
                    </div>
                    <div class="flex justify-between text-sm text-gray-500">
                        <span>0%</span>
                        <span id="batteryStatus">โก ุฌุงุฑู ุงูุดุญู</span>
                        <span>100%</span>
                    </div>
                </div>
                
                <!-- ุฅุญุตุงุฆูุงุช ุงููุธุงู -->
                <div class="bg-white p-5 rounded-2xl shadow-md border border-gray-200">
                    <h3 class="font-bold text-gray-700 mb-4 text-center border-b pb-2">ุฅุญุตุงุฆูุงุช ุงููุธุงู</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">ุงูุทุงูุฉ ุงูููุชุฌุฉ ุงูููู:</span>
                            <span id="energyProduced" class="font-bold text-blue-600">0.00 kWh</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">ุงูุทุงูุฉ ุงููุณุชูููุฉ ุงูููู:</span>
                            <span id="energyConsumed" class="font-bold text-orange-600">0.00 kWh</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">ุตุงูู ุงูุทุงูุฉ:</span>
                            <span id="netEnergy" class="font-bold text-green-600">0.00 kWh</span>
                        </div>
                        <div class="flex justify-between items-center pt-3 border-t border-gray-100">
                            <span class="text-gray-600">ุณุงุนุงุช ุงูุชุดุบูู:</span>
                            <span id="operationHours" class="font-bold text-purple-600">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ุงูุนููุฏ ุงูุฃูุณุท: ูุธุงู ุงูุนุงูุณ -->
            <div class="bg-gradient-to-br from-gray-800 to-gray-900 text-white p-6 rounded-2xl shadow-xl flex flex-col justify-center items-center relative">
                <h3 class="text-gray-300 text-lg font-bold uppercase mb-8 tracking-wider">ูุธุงู ุงูุนุงูุณ (Inverter)</h3>
                
                <div id="inverter" class="relative bg-gray-700 p-8 rounded-full border-4 border-blue-500 w-56 h-56 flex flex-col justify-center items-center text-center">
                    <i class="fas fa-bolt text-gray-400 text-4xl mb-3"></i>
                    <div id="currentLoad" class="text-4xl font-bold">0.00</div>
                    <div class="text-blue-200 mt-1">kW Load</div>
                    <div class="text-gray-400 mt-2 text-sm">ุงูุณุนุฉ: 5.0kW</div>
                </div>

                <!-- ุญุงูุฉ ุงููุธุงู -->
                <div class="mt-8 w-full bg-gray-700/50 p-4 rounded-xl border border-gray-600">
                    <div class="flex justify-between items-center text-base mb-3">
                        <span class="text-gray-300">ุญุงูุฉ ุงููุธุงู:</span>
                        <span id="systemStatus" class="font-bold px-3 py-1 rounded bg-green-900 text-green-300">
                            ูุณุชูุฑ
                        </span>
                    </div>
                    <div class="flex justify-between items-center text-base mb-3">
                        <span class="text-gray-300">ุตุงูู ุงูุชุฏูู:</span>
                        <span id="netFlow" class="font-bold text-green-400">
                            0.00 kW
                        </span>
                    </div>
                    <div class="flex justify-between items-center text-base">
                        <span class="text-gray-300">ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ:</span>
                        <span id="systemTemp" class="font-bold text-gray-300">
                            25ยฐC
                        </span>
                    </div>
                </div>
                
                <!-- ูุคุดุฑ ุงูููุงุฑ/ุงูููู -->
                <div class="mt-6 flex items-center gap-4 bg-gray-700/50 p-4 rounded-xl">
                    <div id="dayNightIcon">
                        <i class="fas fa-sun text-yellow-400 text-2xl"></i>
                    </div>
                    <div>
                        <div class="text-gray-400 text-sm">ุงูููุช ุงูุญุงูู</div>
                        <div id="timePeriod" class="font-bold text-lg">ููุงุฑ</div>
                    </div>
                </div>
            </div>

            <!-- ุงูุฌุงูุจ ุงูุฃููู: ุงูุชุญูู ุจุงูุฃุญูุงู -->
            <div class="space-y-5">
                <h3 class="font-bold text-gray-700 mb-3 text-center text-xl">ุงูุชุญูู ุจุงูุฃุญูุงู (Loads)</h3>
                
                <!-- ูุถุฎุฉ ุงูููุงู -->
                <div class="load-control">
                    <button id="pumpToggle" class="w-full p-5 rounded-2xl border-2 transition-all flex items-center justify-between group border-gray-200 bg-white hover:border-blue-300 hover:shadow-md">
                        <div class="flex items-center gap-4">
                            <div class="p-3 rounded-full bg-gray-100 text-gray-400 group-hover:bg-blue-50 group-hover:text-blue-500 transition-all">
                                <i class="fas fa-tint text-2xl"></i>
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-gray-700 text-lg">ูุถุฎุฉ ุงูููุงู</div>
                                <div class="text-gray-500 text-sm">1.5 kW - 4 ุณุงุนุงุช/ููู</div>
                            </div>
                        </div>
                        <div class="load-indicator w-4 h-4 rounded-full bg-gray-300"></div>
                    </button>
                    <div class="load-status mt-2 text-sm text-gray-500 text-center hidden">
                        <span>โฑ๏ธ ุชุนูู ุญุชู 18:00</span>
                    </div>
                </div>

                <!-- ุฅูุงุฑุฉ ุงููุฎูู -->
                <div class="load-control">
                    <button id="lightsToggle" class="w-full p-5 rounded-2xl border-2 transition-all flex items-center justify-between group border-gray-200 bg-white hover:border-yellow-300 hover:shadow-md">
                        <div class="flex items-center gap-4">
                            <div class="p-3 rounded-full bg-gray-100 text-gray-400 group-hover:bg-yellow-50 group-hover:text-yellow-500 transition-all">
                                <i class="fas fa-lightbulb text-2xl"></i>
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-gray-700 text-lg">ุฅูุงุฑุฉ ุงููุฎูู</div>
                                <div class="text-gray-500 text-sm">0.06 kW - 8 ุณุงุนุงุช/ููู</div>
                            </div>
                        </div>
                        <div class="load-indicator w-4 h-4 rounded-full bg-gray-300"></div>
                    </button>
                    <div class="load-status mt-2 text-sm text-gray-500 text-center hidden">
                        <span>๐ ุชุนูู ุชููุงุฆูุงู ูู ุงููุณุงุก</span>
                    </div>
                </div>

                <!-- ูุญุทุฉ ุงูุดุญู -->
                <div class="load-control">
                    <button id="chargingToggle" class="w-full p-5 rounded-2xl border-2 transition-all flex items-center justify-between group border-gray-200 bg-white hover:border-purple-300 hover:shadow-md">
                        <div class="flex items-center gap-4">
                            <div class="p-3 rounded-full bg-gray-100 text-gray-400 group-hover:bg-purple-50 group-hover:text-purple-500 transition-all">
                                <i class="fas fa-mobile-alt text-2xl"></i>
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-gray-700 text-lg">ูุญุทุฉ ุงูุดุญู</div>
                                <div class="text-gray-500 text-sm">0.2 kW - 100 ุฌูุงุฒ/ููู</div>
                            </div>
                        </div>
                        <div class="load-indicator w-4 h-4 rounded-full bg-gray-300"></div>
                    </button>
                    <div class="load-status mt-2 text-sm text-gray-500 text-center hidden">
                        <span>๐ ูุชุงุญุฉ ุนูุฏ ุชููุฑ ุงูุทุงูุฉ</span>
                    </div>
                </div>

                <!-- ุชุนูููุงุช ุงูุชุดุบูู -->
                <div id="systemWarnings" class="mt-4 p-4 bg-blue-50 rounded-xl border border-blue-200 text-blue-800">
                    <div class="font-bold mb-2 flex items-center gap-2">
                        <i class="fas fa-info-circle text-blue-500"></i>
                        ุชุนูููุงุช ุงูุชุดุบูู
                    </div>
                    <ul class="list-disc mr-5 space-y-1 text-sm">
                        <li>ุงููุถุฎุฉ ุชุนูู ููุงุฑุงู ููุท (6:00 - 18:00)</li>
                        <li>ุงูุฅูุงุฑุฉ ุชุนูู ุชููุงุฆูุงู ูููุงู (18:00 - 6:00)</li>
                        <li>ูุญุทุฉ ุงูุดุญู ูุชุงุญุฉ ุนูุฏูุง ุชููู ุงูุจุทุงุฑูุฉ ููู 20%</li>
                    </ul>
                </div>

                <!-- ุงูุฃุซุฑ ุงูุฅูุณุงูู -->
                <div class="mt-6 bg-gradient-to-r from-green-50 to-blue-50 p-5 rounded-2xl border border-green-200 shadow-sm">
                    <h4 class="font-bold text-gray-800 text-center mb-4 text-lg">ุงูุฃุซุฑ ุงูุฅูุณุงูู</h4>
                    <div class="grid grid-cols-2 gap-4 text-center">
                        <div class="bg-white p-3 rounded-xl shadow-sm">
                            <div id="waterBeneficiaries" class="text-2xl font-bold text-blue-600">0</div>
                            <div class="text-gray-600 text-sm">ูุณุชููุฏ ูู ุงูููุงู</div>
                        </div>
                        <div class="bg-white p-3 rounded-xl shadow-sm">
                            <div id="lightBeneficiaries" class="text-2xl font-bold text-yellow-600">0</div>
                            <div class="text-gray-600 text-sm">ูุณุชููุฏ ูู ุงูุฅูุงุฑุฉ</div>
                        </div>
                        <div class="bg-white p-3 rounded-xl shadow-sm">
                            <div id="chargeBeneficiaries" class="text-2xl font-bold text-purple-600">0</div>
                            <div class="text-gray-600 text-sm">ุฌูุงุฒ ูุดุญูู/ููู</div>
                        </div>
                        <div class="bg-white p-3 rounded-xl shadow-sm">
                            <div id="co2Saved" class="text-2xl font-bold text-green-600">0.0</div>
                            <div class="text-gray-600 text-sm">ูุฌู CO2/ููู</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ูุนูููุงุช ุงููุดุฑูุน -->
        <div class="mt-8 bg-white p-5 rounded-2xl shadow-sm border border-gray-200 text-center">
            <p class="text-gray-600">
                ูุดุฑูุน ุงูุทุงูุฉ ุงูุดูุณูุฉ ููุฎููุงุช ุงููุงุฒุญูู ูู ูุทุงุน ุบุฒุฉ - 100 ูุญุฏุฉ ุทุงูุฉ ุดูุณูุฉ ุจูุฏุฑุฉ 5kW ูุชูููุฑ ุฎุฏูุงุช ุฃุณุงุณูุฉ ููุญู 50,000 ูุงุฒุญ
            </p>
        </div>
    </div>

    <script>
        // ุซูุงุจุช ุงููุธุงู
        const SYSTEM_SPECS = {
            pvCapacity: 5.5, // kWp
            batteryCapacity: 18, // kWh
            inverterCapacity: 5.0, // kW
            loads: {
                pump: 1.5, // kW
                lights: 0.06, // kW
                charging: 0.20 // kW
            }
        };

        // ุญุงูุฉ ุงููุญุงูุงุฉ
        let simulationState = {
            time: 6, // ุชุจุฏุฃ ุงูุณุงุนุฉ 6:00 ุตุจุงุญุงู
            batterySoc: 50, // ูุณุจุฉ ุงูุดุญู 50%
            activeLoads: {
                pump: false,
                lights: false,
                charging: false
            },
            isSimulating: false,
            pvOutput: 0,
            totalLoad: 0,
            gridStatus: 'Normal',
            energyProduced: 0,
            energyConsumed: 0,
            operationHours: 0,
            intervalId: null
        };

        // ุนูุงุตุฑ DOM
        const elements = {
            time: document.getElementById('currentTime'),
            simulationToggle: document.getElementById('simulationToggle'),
            pvOutput: document.getElementById('pvOutput'),
            pvProgress: document.getElementById('pvProgress'),
            pvEfficiency: document.getElementById('pvEfficiency'),
            batterySoc: document.getElementById('batterySoc'),
            batteryProgress: document.getElementById('batteryProgress'),
            batteryStatus: document.getElementById('batteryStatus'),
            currentLoad: document.getElementById('currentLoad'),
            systemStatus: document.getElementById('systemStatus'),
            netFlow: document.getElementById('netFlow'),
            systemTemp: document.getElementById('systemTemp'),
            inverter: document.getElementById('inverter'),
            dayNightIcon: document.getElementById('dayNightIcon'),
            timePeriod: document.getElementById('timePeriod'),
            energyProduced: document.getElementById('energyProduced'),
            energyConsumed: document.getElementById('energyConsumed'),
            netEnergy: document.getElementById('netEnergy'),
            operationHours: document.getElementById('operationHours'),
            systemWarnings: document.getElementById('systemWarnings')
        };

        // ุนูุงุตุฑ ุงูุชุญูู ุจุงูุฃุญูุงู
        const loadControls = {
            pump: {
                toggle: document.getElementById('pumpToggle'),
                indicator: document.querySelector('#pumpToggle .load-indicator'),
                status: document.querySelector('#pumpToggle').closest('.load-control').querySelector('.load-status')
            },
            lights: {
                toggle: document.getElementById('lightsToggle'),
                indicator: document.querySelector('#lightsToggle .load-indicator'),
                status: document.querySelector('#lightsToggle').closest('.load-control').querySelector('.load-status')
            },
            charging: {
                toggle: document.getElementById('chargingToggle'),
                indicator: document.querySelector('#chargingToggle .load-indicator'),
                status: document.querySelector('#chargingToggle').closest('.load-control').querySelector('.load-status')
            }
        };

        // ุนูุงุตุฑ ุงูุฃุซุฑ ุงูุฅูุณุงูู
        const beneficiaryElements = {
            water: document.getElementById('waterBeneficiaries'),
            light: document.getElementById('lightBeneficiaries'),
            charge: document.getElementById('chargeBeneficiaries'),
            co2: document.getElementById('co2Saved')
        };

        // ุชูุณูู ุงูููุช ููุนุฑุถ
        function formatTime(t) {
            const hours = Math.floor(t);
            const minutes = Math.floor((t - hours) * 60);
            const ampm = hours >= 12 ? 'ูุณุงุกู' : 'ุต';
            const displayHours = hours % 12 || 12;
            return `${displayHours}:${minutes < 10 ? '0' : ''}${minutes} ${ampm}`;
        }

        // ุชุญุฏูุซ ุนุฑุถ ุงูููุช
        function updateTimeDisplay() {
            elements.time.textContent = formatTime(simulationState.time);
            
            // ุชุญุฏูุซ ูุคุดุฑ ุงูููุงุฑ/ุงูููู
            const isDaytime = simulationState.time > 6 && simulationState.time < 18;
            if (isDaytime) {
                elements.dayNightIcon.innerHTML = '<i class="fas fa-sun text-yellow-400 text-2xl"></i>';
                elements.timePeriod.textContent = 'ููุงุฑ';
            } else {
                elements.dayNightIcon.innerHTML = '<i class="fas fa-moon text-blue-300 text-2xl"></i>';
                elements.timePeriod.textContent = 'ููู';
            }
        }

        // ุญุณุงุจ ุฅูุชุงุฌ ุงูุฃููุงุญ ุงูุดูุณูุฉ ุจูุงุกู ุนูู ุงูููุช
        function calculatePvOutput() {
            let solarFactor = 0;
            if (simulationState.time >= 6 && simulationState.time <= 18) {
                const hourRatio = (simulationState.time - 6) / 12;
                solarFactor = Math.pow(Math.sin(hourRatio * Math.PI), 1.2);
                
                // ุชูููู ุงูุฅูุชุงุฌ ูู ุงูุตุจุงุญ ุงูุจุงูุฑ ูุงููุณุงุก
                if (simulationState.time < 8 || simulationState.time > 16) solarFactor *= 0.7;
            }
            return solarFactor * SYSTEM_SPECS.pvCapacity;
        }

        // ุชุญุฏูุซ ุนูุงุตุฑ ุงูุชุญูู ุจูุงุกู ุนูู ุงูููุช ูุงูุจุทุงุฑูุฉ
        function updateLoadControls() {
            const isDaytime = simulationState.time > 6 && simulationState.time < 18;
            const isNighttime = simulationState.time >= 18 || simulationState.time <= 6;
            
            // ุงูุชุญูู ุงูุชููุงุฆู ูู ุงูุฅูุงุฑุฉ (ุชุนูู ูููุงู)
            if (isNighttime && simulationState.batterySoc > 10) {
                simulationState.activeLoads.lights = true;
            } else if (isDaytime) {
                simulationState.activeLoads.lights = false;
            }
            
            // ุงูุชุญูู ุงูุชููุงุฆู ูู ุงููุถุฎุฉ (ููุงุฑุงู ููุท)
            if (!isDaytime && simulationState.activeLoads.pump) {
                simulationState.activeLoads.pump = false;
            }
            
            // ุงูุชุญูู ุงูุชููุงุฆู ูู ุงูุดุญู (ูุน ุจุทุงุฑูุฉ ูุงููุฉ)
            if (simulationState.batterySoc <= 20 && simulationState.activeLoads.charging) {
                simulationState.activeLoads.charging = false;
            }
            
            updateLoadIndicators();
        }

        // ุชุญุฏูุซ ูุคุดุฑุงุช ุงูุฃุญูุงู ูู ุงููุงุฌูุฉ
        function updateLoadIndicators() {
            // ุชุญุฏูุซ ุงููุถุฎุฉ
            updateLoadIndicator('pump', 'blue');
            
            // ุชุญุฏูุซ ุงูุฅูุงุฑุฉ
            updateLoadIndicator('lights', 'yellow');
            
            // ุชุญุฏูุซ ุงูุดุญู
            updateLoadIndicator('charging', 'purple');
        }

        // ุฏุงูุฉ ูุณุงุนุฏุฉ ูุชุญุฏูุซ ูุคุดุฑ ุญูู ูุนูู
        function updateLoadIndicator(load, color) {
            const control = loadControls[load];
            
            if (simulationState.activeLoads[load]) {
                control.toggle.classList.remove('border-gray-200', 'bg-white');
                control.toggle.classList.add(`border-${color}-500`, `bg-${color}-50`, 'load-active');
                control.indicator.classList.remove('bg-gray-300');
                control.indicator.classList.add('bg-green-500');
                control.status.classList.remove('hidden');
            } else {
                control.toggle.classList.remove(`border-${color}-500`, `bg-${color}-50`, 'load-active');
                control.toggle.classList.add('border-gray-200', 'bg-white');
                control.indicator.classList.remove('bg-green-500');
                control.indicator.classList.add('bg-gray-300');
                control.status.classList.add('hidden');
            }
        }

        // ุญุณุงุจ ุงูุญูู ุงูููู
        function calculateTotalLoad() {
            let currentLoad = 0;
            if (simulationState.activeLoads.pump) currentLoad += SYSTEM_SPECS.loads.pump;
            if (simulationState.activeLoads.lights) currentLoad += SYSTEM_SPECS.loads.lights;
            if (simulationState.activeLoads.charging) currentLoad += SYSTEM_SPECS.loads.charging;
            return currentLoad;
        }

        // ุชุญุฏูุซ ุญุงูุฉ ุงูุจุทุงุฑูุฉ
        function updateBattery() {
            // ุชุฏูู ุงูุทุงูุฉ = ุงูุชูููุฏ - ุงูุงุณุชููุงู
            const netPower = simulationState.pvOutput - simulationState.totalLoad;
            
            // ุฏูุชุง (kWh) ููู ุฎุทูุฉ 15 ุฏูููุฉ (0.25h)
            const energyStep = netPower * 0.25;
            
            // ุชุญุฏูุซ ูุณุจุฉ ุดุญู ุงูุจุทุงุฑูุฉ
            const socChange = (energyStep / SYSTEM_SPECS.batteryCapacity) * 100;
            simulationState.batterySoc += socChange;
            
            // ุชุญุฏูุฏ ุงููุณุจุฉ ุจูู 0 ู 100
            simulationState.batterySoc = Math.min(Math.max(simulationState.batterySoc, 0), 100);
            
            // ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงูุทุงูุฉ
            if (netPower > 0) {
                simulationState.energyProduced += netPower * 0.25;
            } else {
                simulationState.energyConsumed += Math.abs(netPower) * 0.25;
            }
            
            // ุชุญุฏูุซ ุณุงุนุงุช ุงูุชุดุบูู ุฅุฐุง ูุงู ููุงู ุญูู ูุดุท
            if (simulationState.totalLoad > 0) {
                simulationState.operationHours += 0.25;
            }
        }

        // ุชุญุฏูุซ ุญุงูุฉ ุงููุธุงู
        function updateSystemStatus() {
            // ุงูุชุญูู ูู ุงูุญูููุฉ ุงูุฒุงุฆุฏุฉ
            if (simulationState.totalLoad > SYSTEM_SPECS.inverterCapacity) {
                simulationState.gridStatus = 'OVERLOAD';
                elements.systemStatus.textContent = 'ุญูููุฉ ุฒุงุฆุฏุฉ';
                elements.systemStatus.className = 'font-bold px-3 py-1 rounded bg-red-900 text-red-300 pulse-warning';
            } 
            // ุงูุชุญูู ูู ุงูุงููุทุงุน
            else if (simulationState.batterySoc <= 0 && simulationState.pvOutput < simulationState.totalLoad) {
                simulationState.gridStatus = 'BLACKOUT';
                elements.systemStatus.textContent = 'ุงููุทุงุน ุชุงู';
                elements.systemStatus.className = 'font-bold px-3 py-1 rounded bg-red-900 text-red-300 pulse-warning';
            }
            // ุงูุชุญูู ูู ุงูุจุทุงุฑูุฉ ุงูููุฎูุถุฉ
            else if (simulationState.batterySoc <= 10) {
                simulationState.gridStatus = 'LOW_BATTERY';
                elements.systemStatus.textContent = 'ุจุทุงุฑูุฉ ููุฎูุถุฉ';
                elements.systemStatus.className = 'font-bold px-3 py-1 rounded bg-orange-900 text-orange-300 pulse-warning';
            }
            // ุงูุชุดุบูู ุงูุนุงุฏู
            else {
                simulationState.gridStatus = 'Normal';
                elements.systemStatus.textContent = 'ูุณุชูุฑ';
                elements.systemStatus.className = 'font-bold px-3 py-1 rounded bg-green-900 text-green-300';
            }
            
            // ุชุญุฏูุซ ุตุงูู ุงูุชุฏูู
            const netFlow = simulationState.pvOutput - simulationState.totalLoad;
            elements.netFlow.textContent = `${netFlow.toFixed(2)} kW`;
            if (netFlow >= 0) {
                elements.netFlow.className = 'font-bold text-green-400';
            } else {
                elements.netFlow.className = 'font-bold text-red-400';
            }
            
            // ุชุญุฏูุซ ุฏุฑุฌุฉ ุญุฑุงุฑุฉ ุงููุธุงู (ูุญุงูุงุฉ)
            const baseTemp = 25;
            const loadEffect = simulationState.totalLoad * 2;
            const pvEffect = simulationState.pvOutput * 0.5;
            const batteryEffect = (50 - simulationState.batterySoc) * 0.1;
            const systemTemp = baseTemp + loadEffect + pvEffect + batteryEffect;
            elements.systemTemp.textContent = `${systemTemp.toFixed(1)}ยฐC`;
            
            // ุชุญุฏูุซ ุชุฃุซูุฑ ุงูููุฌ ููุนุงูุณ
            if (simulationState.totalLoad > 0) {
                elements.inverter.classList.add('glow');
                elements.inverter.querySelector('i').classList.remove('text-gray-400');
                elements.inverter.querySelector('i').classList.add('text-blue-400');
            } else {
                elements.inverter.classList.remove('glow');
                elements.inverter.querySelector('i').classList.remove('text-blue-400');
                elements.inverter.querySelector('i').classList.add('text-gray-400');
            }
        }

        // ุชุญุฏูุซ ุฃุนุฏุงุฏ ุงููุณุชููุฏูู
        function updateBeneficiaryCounts() {
            // ูุณุชููุฏู ุงูููุงู (ุจูุงุกู ุนูู ุชุดุบูู ุงููุถุฎุฉ)
            if (simulationState.activeLoads.pump) {
                beneficiaryElements.water.textContent = '300';
            } else {
                beneficiaryElements.water.textContent = '0';
            }
            
            // ูุณุชููุฏู ุงูุฅูุงุฑุฉ (ุจูุงุกู ุนูู ุชุดุบูู ุงูุฅูุงุฑุฉ)
            if (simulationState.activeLoads.lights) {
                beneficiaryElements.light.textContent = '500';
            } else {
                beneficiaryElements.light.textContent = '0';
            }
            
            // ูุณุชููุฏู ุงูุดุญู (ุจูุงุกู ุนูู ุชุดุบูู ุงูุดุญู)
            if (simulationState.activeLoads.charging) {
                beneficiaryElements.charge.textContent = '100';
            } else {
                beneficiaryElements.charge.textContent = '0';
            }
            
            // ุซุงูู ุฃูุณูุฏ ุงููุฑุจูู ุงูููููุฑ (ุจูุงุกู ุนูู ุงูุทุงูุฉ ุงูููุชุฌุฉ)
            const co2Saved = simulationState.energyProduced * 0.5; // ูุฌู CO2 ููู kWh
            beneficiaryElements.co2.textContent = co2Saved.toFixed(1);
        }

        // ุชุญุฏูุซ ุฌููุน ุงูุนุฑูุถ
        function updateDisplays() {
            // ุชุญุฏูุซ ุนุฑูุถ ุงูุฃููุงุญ ุงูุดูุณูุฉ
            elements.pvOutput.textContent = simulationState.pvOutput.toFixed(2);
            const pvPercentage = (simulationState.pvOutput / SYSTEM_SPECS.pvCapacity) * 100;
            elements.pvProgress.style.width = `${pvPercentage}%`;
            elements.pvEfficiency.textContent = `ููุงุกุฉ: ${Math.round(pvPercentage)}%`;
            
            // ุชุญุฏูุซ ุนุฑูุถ ุงูุจุทุงุฑูุฉ
            elements.batterySoc.textContent = `${Math.round(simulationState.batterySoc)}%`;
            elements.batteryProgress.style.width = `${simulationState.batterySoc}%`;
            
            if (simulationState.batterySoc > 20) {
                elements.batteryProgress.className = 'h-4 rounded-full transition-all duration-500 bg-green-500';
            } else {
                elements.batteryProgress.className = 'h-4 rounded-full transition-all duration-500 bg-red-500 pulse-warning';
            }
            
            if (simulationState.pvOutput > simulationState.totalLoad) {
                elements.batteryStatus.textContent = 'โก ุฌุงุฑู ุงูุดุญู';
            } else if (simulationState.totalLoad > 0) {
                elements.batteryStatus.textContent = '๐ป ุฌุงุฑู ุงูุชูุฑูุบ';
            } else {
                elements.batteryStatus.textContent = 'ุฎุงูู';
            }
            
            // ุชุญุฏูุซ ุนุฑุถ ุงูุญูู
            elements.currentLoad.textContent = simulationState.totalLoad.toFixed(2);
            
            // ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงูุทุงูุฉ
            elements.energyProduced.textContent = `${simulationState.energyProduced.toFixed(2)} kWh`;
            elements.energyConsumed.textContent = `${simulationState.energyConsumed.toFixed(2)} kWh`;
            elements.netEnergy.textContent = `${(simulationState.energyProduced - simulationState.energyConsumed).toFixed(2)} kWh`;
            elements.operationHours.textContent = Math.round(simulationState.operationHours);
            
            // ุชุญุฏูุซ ุฃุนุฏุงุฏ ุงููุณุชููุฏูู
            updateBeneficiaryCounts();
        }

        // ุฎุทูุฉ ุงููุญุงูุงุฉ
        function simulationStep() {
            // ุชูุฏู ุงูููุช
            simulationState.time += 0.25;
            if (simulationState.time >= 24) simulationState.time = 0;
            
            updateTimeDisplay();
            
            // ุชุญุฏูุซ ุฅูุชุงุฌ ุงูุฃููุงุญ ุงูุดูุณูุฉ
            simulationState.pvOutput = calculatePvOutput();
            
            // ุชุญุฏูุซ ุนูุงุตุฑ ุงูุชุญูู ุจูุงุกู ุนูู ุงูููุช ูุงูุจุทุงุฑูุฉ
            updateLoadControls();
            
            // ุญุณุงุจ ุงูุญูู ุงูููู
            simulationState.totalLoad = calculateTotalLoad();
            
            // ุชุญุฏูุซ ุงูุจุทุงุฑูุฉ
            updateBattery();
            
            // ุชุญุฏูุซ ุญุงูุฉ ุงููุธุงู
            updateSystemStatus();
            
            // ุชุญุฏูุซ ุฌููุน ุงูุนุฑูุถ
            updateDisplays();
        }

        // ุชุจุฏูู ุงููุญุงูุงุฉ
        function toggleSimulation() {
            simulationState.isSimulating = !simulationState.isSimulating;
            
            if (simulationState.isSimulating) {
                elements.simulationToggle.textContent = 'ุฅููุงู ูุคูุช โธ';
                elements.simulationToggle.classList.remove('bg-green-500', 'hover:bg-green-600');
                elements.simulationToggle.classList.add('bg-red-500', 'hover:bg-red-600');
                
                // ุจุฏุก ุญููุฉ ุงููุญุงูุงุฉ
                simulationState.intervalId = setInterval(simulationStep, 500);
            } else {
                elements.simulationToggle.textContent = 'ุชุดุบูู ุงููุญุงูุงุฉ โถ';
                elements.simulationToggle.classList.remove('bg-red-500', 'hover:bg-red-600');
                elements.simulationToggle.classList.add('bg-green-500', 'hover:bg-green-600');
                
                // ุฅููุงู ุญููุฉ ุงููุญุงูุงุฉ
                clearInterval(simulationState.intervalId);
            }
        }

        // ุชุจุฏูู ุงูุญูู
        function toggleLoad(load) {
            // ุงูุชุญูู ูู ุงููููุฏ ูุจู ุงูุชุจุฏูู
            const isDaytime = simulationState.time > 6 && simulationState.time < 18;
            
            if (load === 'pump' && !isDaytime) {
                // ุนุฑุถ ุชุญุฐูุฑ ูููุถุฎุฉ ูููุงู
                elements.systemWarnings.innerHTML = `
                    <div class="font-bold mb-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-triangle text-orange-500"></i>
                        ุชูุจูู
                    </div>
                    <p class="text-sm">ุงููุถุฎุฉ ูุง ูููู ุชุดุบูููุง ูููุงู ููุญูุงุธ ุนูู ุงูุจุทุงุฑูุฉ. ุงูุฑุฌุงุก ุชุดุบูููุง ุฎูุงู ุงูููุงุฑ (6:00 - 18:00).</p>
                `;
                elements.systemWarnings.className = 'mt-4 p-4 bg-orange-50 rounded-xl border border-orange-200 text-orange-800';
                return;
            }
            
            if (load === 'charging' && simulationState.batterySoc <= 20) {
                // ุนุฑุถ ุชุญุฐูุฑ ููุดุญู ูุน ุจุทุงุฑูุฉ ููุฎูุถุฉ
                elements.systemWarnings.innerHTML = `
                    <div class="font-bold mb-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-triangle text-orange-500"></i>
                        ุชูุจูู
                    </div>
                    <p class="text-sm">ูุง ูููู ุชุดุบูู ูุญุทุฉ ุงูุดุญู ุนูุฏูุง ุชููู ุงูุจุทุงุฑูุฉ ุฃูู ูู 20%.</p>
                `;
                elements.systemWarnings.className = 'mt-4 p-4 bg-orange-50 rounded-xl border border-orange-200 text-orange-800';
                return;
            }
            
            // ุชุจุฏูู ุงูุญูู
            simulationState.activeLoads[load] = !simulationState.activeLoads[load];
            updateLoadIndicators();
            
            // ุฅุนุงุฏุฉ ุชุนููู ุงูุชุญุฐูุฑุงุช ุฅุฐุง ูุฌุญ ุงูุชุจุฏูู
            elements.systemWarnings.innerHTML = `
                <div class="font-bold mb-2 flex items-center gap-2">
                    <i class="fas fa-info-circle text-blue-500"></i>
                    ุชุนูููุงุช ุงูุชุดุบูู
                </div>
                <ul class="list-disc mr-5 space-y-1 text-sm">
                    <li>ุงููุถุฎุฉ ุชุนูู ููุงุฑุงู ููุท (6:00 - 18:00)</li>
                    <li>ุงูุฅูุงุฑุฉ ุชุนูู ุชููุงุฆูุงู ูููุงู (18:00 - 6:00)</li>
                    <li>ูุญุทุฉ ุงูุดุญู ูุชุงุญุฉ ุนูุฏูุง ุชููู ุงูุจุทุงุฑูุฉ ููู 20%</li>
                </ul>
            `;
            elements.systemWarnings.className = 'mt-4 p-4 bg-blue-50 rounded-xl border border-blue-200 text-blue-800';
        }

        // ุชููุฆุฉ ุงููุญุงูุงุฉ
        function initSimulation() {
            updateTimeDisplay();
            updateLoadIndicators();
            updateDisplays();
            
            // ุฅุถุงูุฉ ูุณุชูุนู ุงูุฃุญุฏุงุซ
            elements.simulationToggle.addEventListener('click', toggleSimulation);
            
            loadControls.pump.toggle.addEventListener('click', () => toggleLoad('pump'));
            loadControls.lights.toggle.addEventListener('click', () => toggleLoad('lights'));
            loadControls.charging.toggle.addEventListener('click', () => toggleLoad('charging'));
            
            // ุฎุทูุฉ ูุญุงูุงุฉ ุฃูููุฉ ูุฅุนุฏุงุฏ ุงูุนุฑูุถ
            simulationStep();
        }

        // ุจุฏุก ุงููุญุงูุงุฉ ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        document.addEventListener('DOMContentLoaded', initSimulation);
    </script>
</body>
</html>
